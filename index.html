<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
    <title>GifTastic</title>
</head>

<body>
    <h1>GifTastic</h1>
    <div class="container buttons">
        <div class="row" id="buttons">

        </div>
    </div>
    <div class="container giphy-container">
        <div class="row">
            <div class="col-lg-9">
                <div class="row" id="giphies">

                </div>
            </div>
            <div class="col-lg-3">
                <form>
                    <div class="form-group">
                        <label for="topic-input">New Topic</label>
                        <input type="text" class="form-control" id="topic-input" placeholder="Search a new topic">
                    </div>
                    <button type="submit" class="btn btn-primary" id="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script>
        var preFilledTopics = ["apple", "cars", "dogs", "cat"];
        var buttonContainer = $("#buttons");
        preFilledTopics.forEach(e => {
            generateButton(e);
        });

        $("#submit").click(function (e) {
            e.preventDefault();
            if ($("#topic-input").val() != "") {
                generateButton($("#topic-input").val());
                console.log("generating new button");
            }
        });

        function generateButton(topic) {
            var button = $("<button>").attr("topic", topic).text(topic).addClass("btn btn-success btn-lg");
            button.click(function () {
                fetchGiphy(button.attr("topic"));
            });
            buttonContainer.append(button);
        }

        function fetchGiphy(topic) {
            var giphyArray = [];
            const apikey = "JkPb46q9c58NLlRLRB76YMfdwkFLGVj0";
            var offset = 0;
            var url = `https://api.giphy.com/v1/gifs/search?api_key=${apikey}&q=${topic}&limit=9&offset=${offset++}&lang=en`;
            $.ajax({
                url: url,
                method: "GET"
            }).then(function (response) {
                response.data.forEach(e => {
                    var object = {
                        rating: e.rating,
                        imageAnimated: e.images.fixed_width.url,
                        imageStill: e.images.fixed_width_still.url,
                    };
                    // console.log(object);
                    giphyArray.push(object);
                });
                updateUI(giphyArray);
            });
        }

        function updateUI(arr) {
            var giphies = $("#giphies");
            giphies.empty();
            arr.forEach(e => {
                var card = $("<div>").addClass("card col-md-4").html(
                    `
                    <div class="card-body">
                        <p class="card-text"></p>
                    </div>
                    `
                );
                var img = $("<img>").addClass("card-img-top img-fluid").attr({ "src": e.imageStill, "image-animated": e.imageAnimated, "image-still": e.imageStill, "toggle": "still" }).prependTo(card);
                img.click(function () {
                    if ($(this).attr("toggle") === "still") {
                        $(this).attr("src", $(this).attr("image-animated"));
                        $(this).attr("toggle", "animated");
                    } else {
                        $(this).attr("src", $(this).attr("image-still"));
                        $(this).attr("toggle", "still");
                    }
                });
                card.find(".card-body").css("padding", "0");
                card.find(".card-text").text(`Rating: ${e.rating}`);
                card.appendTo(giphies);
            });
        }
    </script>
</body>

</html>